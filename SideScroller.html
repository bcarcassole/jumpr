<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>JUMPR</title>
<style>
    body {
        margin: 0;
        background: #111;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        font-family: Arial, sans-serif;
    }
    canvas {
        background: linear-gradient(#87ceeb, #e0f6ff);
        border: 3px solid white;
    }
</style>
</head>
<body>

<canvas id="game" width="800" height="300"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// ===================
// AUDIO (Web Audio)
// ===================
let audioCtx = null;

function initAudio() {
    if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
}

// Jump sound ("boing")
function playJumpSound() {
    if (!audioCtx) return;

    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();

    osc.type = "sine";
    osc.frequency.setValueAtTime(220, audioCtx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(440, audioCtx.currentTime + 0.15);

    gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);

    osc.connect(gain).connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 0.2);
}

// Crash sound
function playCrashSound() {
    if (!audioCtx) return;

    const bufferSize = audioCtx.sampleRate * 0.2;
    const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
    const data = buffer.getChannelData(0);

    for (let i = 0; i < bufferSize; i++) {
        data[i] = Math.random() * 2 - 1;
    }

    const source = audioCtx.createBufferSource();
    const gain = audioCtx.createGain();

    source.buffer = buffer;
    gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);

    source.connect(gain).connect(audioCtx.destination);
    source.start();
}

// ===================
// GAME CONSTANTS
// ===================
const GROUND_Y = 220;
const GRAVITY = 0.45;
const JUMP_FORCE = -17;

// ===================
// GAME STATE
// ===================
let speed = 3;
let score = 0;
let gameOver = false;
let gameStarted = false;

// Player
const player = {
    x: 100,
    y: GROUND_Y,
    w: 40,
    h: 40,
    vy: 0,
    onGround: true
};

// Obstacle types
const obstacleTypes = [
    { w: 30, h: 50, color: "#d9534f" },
    { w: 30, h: 80, color: "#5bc0de" },
    { w: 60, h: 40, color: "#5cb85c" },
    { w: 50, h: 60, color: "#f0ad4e" }
];

let obstacle = null;

function createObstacle() {
    const t = obstacleTypes[Math.floor(Math.random() * obstacleTypes.length)];
    return {
        x: canvas.width + 100,
        y: GROUND_Y + (player.h - t.h),
        w: t.w,
        h: t.h,
        color: t.color
    };
}

// ===================
// INPUT
// ===================
document.addEventListener("keydown", e => {
    if (e.code !== "Space") return;

    initAudio();

    if (!gameStarted) {
        startGame();
        return;
    }

    if (!gameOver && player.onGround) {
        player.vy = JUMP_FORCE;
        player.onGround = false;
        playJumpSound();
    } else if (gameOver) {
        resetGame();
    }
});

function startGame() {
    gameStarted = true;
    resetGame();
}

function resetGame() {
    gameOver = false;
    score = 0;
    speed = 3;
    player.y = GROUND_Y;
    player.vy = 0;
    player.onGround = true;
    obstacle = createObstacle();
}

// ===================
// UPDATE
// ===================
function update() {
    if (!gameStarted || gameOver) return;

    // Player physics
    player.vy += GRAVITY;
    player.y += player.vy;

    if (player.y >= GROUND_Y) {
        player.y = GROUND_Y;
        player.vy = 0;
        player.onGround = true;
    }

    // Obstacle movement
    obstacle.x -= speed;

    // Passed obstacle
    if (obstacle.x + obstacle.w < player.x - 50) {
        score++;
        speed *= 1.05;
        obstacle = createObstacle();
    }

    // Collision
    if (
        player.x < obstacle.x + obstacle.w &&
        player.x + player.w > obstacle.x &&
        player.y < obstacle.y + obstacle.h &&
        player.y + player.h > obstacle.y
    ) {
        gameOver = true;
        playCrashSound();
    }
}

// ===================
// DRAW
// ===================
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Startup screen
    if (!gameStarted) {
        ctx.fillStyle = "#000";
        ctx.font = "64px Arial";
        ctx.fillText("JUMPR", 280, 130);
        ctx.font = "20px Arial";
        ctx.fillText("Press Spacebar to Start", 265, 170);
        return;
    }

    // Ground
    ctx.fillStyle = "#444";
    ctx.fillRect(0, GROUND_Y + player.h, canvas.width, 40);

    // Player
    ctx.fillStyle = "#ffcc00";
    ctx.fillRect(player.x, player.y, player.w, player.h);

    // Obstacle
    ctx.fillStyle = obstacle.color;
    ctx.fillRect(obstacle.x, obstacle.y, obstacle.w, obstacle.h);

    // UI
    ctx.fillStyle = "#000";
    ctx.font = "18px Arial";
    ctx.fillText("Score: " + score, 10, 25);

    if (gameOver) {
        ctx.font = "32px Arial";
        ctx.fillText("Game Over", 310, 130);
        ctx.font = "18px Arial";
        ctx.fillText("Press Space to Restart", 290, 165);
    }
}

// ===================
// LOOP
// ===================
function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
